# Fixpoint-Programming-Test
株式会社フィックスポイント プログラミング試験
============================================

## 概要
監視ログファイルを読み込み、故障状態のサーバアドレスとそのサーバの故障期間を出力するプログラム

設問 | ファイル名
------------ | -------------
設問 1|　`q1.py`
設問 2|　`q2.py`
設問 3|　`q3.py`
設問 4|　`q4.py`

### 環境
- python 3.8.7
- Windows 10

## 必要な事
### .env（環境変数）を入力
```
FILE_NAME = ログ　の　ファイル名
ERROR_NUM =　設問2　の　N値
COUNT_AVERAGE =　設問3　の　m値
MAX_TIMEOUT =　設問3　の　t値（ミリ秒）
SERVER_DOWN =　設問4　の　N値
```
### ライブラリーのインストール
もしダウンロードされていない場合は以下のコマンドをターミナルで実行
```
$ pip install `ライブラリー名`
```
### ログファイルを作成
- ログを.txtとして保存します
```
20201019133124,10.20.30.1/16,2
20201019133125,10.20.30.2/16,2
20201019133134,192.168.1.1/24,-
20201019133135,192.168.1.2/24,2
20201019133224,10.20.30.1/16,2
20201019133225,10.20.30.2/16,2
20201019133234,192.168.1.1/24,-
20201019133235,192.168.1.2/24,2
20201019133324,10.20.30.1/16,2
20201019133325,10.20.30.2/16,-
20201019133334,192.168.1.1/24,1
20201019133335,192.168.1.1/24,3
20201019133336,10.20.30.1/16,10
20201019133337,10.20.30.2/16,20
20201019133338,192.168.1.1/24,20
20201019133339,192.168.1.2/24,20
20201019133340,10.20.30.1/16,20
20201019133341,10.20.30.2/16,20
20201019133342,192.168.1.1/24,40
20201019133343,192.168.1.2/24,40
20201019133344,10.20.30.1/16,-
20201019133345,10.20.30.2/16,-
20201019133346,192.168.1.1/24,40
20201019133347,192.168.1.1/24,40
20201019133347,192.168.1.2/24,40
```

### 実行方法
以下のコマンドで実行する
```
$ py `ファイル名`
```
```
$ py q1.py
```

## Demo
### .envの値
-  20000 ms = 20秒
```
FILE_NAME = log.txt
ERROR_NUM = 2
COUNT_AVERAGE = 3
MAX_TIMEOUT = 30000
SERVER_DOWN = 2
```
### q1.pyの実行後

#### テキストファイルからログを読み込む
```
20201019133124,10.20.30.1/16,2
20201019133125,10.20.30.2/16,2
20201019133134,192.168.1.1/24,-
20201019133135,192.168.1.2/24,2
20201019133224,10.20.30.1/16,2
20201019133225,10.20.30.2/16,2
20201019133234,192.168.1.1/24,-
20201019133235,192.168.1.2/24,2
20201019133324,10.20.30.1/16,2
20201019133325,10.20.30.2/16,-
20201019133334,192.168.1.1/24,1
20201019133335,192.168.1.1/24,3
20201019133336,10.20.30.1/16,10
20201019133337,10.20.30.2/16,20
20201019133338,192.168.1.1/24,20
20201019133339,192.168.1.2/24,20
20201019133340,10.20.30.1/16,20
20201019133341,10.20.30.2/16,20
20201019133342,192.168.1.1/24,40
20201019133343,192.168.1.2/24,40
20201019133344,10.20.30.1/16,-
20201019133345,10.20.30.2/16,-
20201019133346,192.168.1.1/24,40
20201019133347,192.168.1.1/24,40
20201019133347,192.168.1.2/24,40
```

##### 以下の物がターミナルに表示される

- タイムアウトしたままのIPを出力
```
UNRECOVERED IP

10.20.30.1/16 not recovered since 20201019133344
10.20.30.2/16 not recovered since 20201019133345
```
- IPがいつ回復したかを出力
```
RECOVERED IP SESSION

192.168.1.1/24 recovered at 2020-10-19 13:33:34 from 2020-10-19 13:31:34 time-out: 120 sec
10.20.30.2/16 recovered at 2020-10-19 13:33:37 from 2020-10-19 13:33:25 time-out: 12 sec
```

### q2.pyの実行後
>  q1.pyを拡張

- ログはq1.pyと同じものを使う
```
UNRECOVERED IP

10.20.30.1/16 not recovered since 20201019133344
10.20.30.2/16 not recovered since 20201019133345
```
- 最初のタイムアウト時から合計タイムアウト時間を計算
```
RECOVERED IP SESSION

192.168.1.1/24 recovered at 2020-10-19 13:33:34 from 2020-10-19 13:31:34 time-out: 120 sec
```
### q3.pyの実行後
>  q2.pyを拡張

- 下記ののログを使用
```
20201019133124,10.20.30.1/16,2
20201019133125,10.20.30.2/16,2
20201019133134,192.168.1.1/24,-
20201019133135,192.168.1.2/24,2
20201019133224,10.20.30.1/16,2
20201019133225,10.20.30.2/16,500
20201019133234,192.168.1.1/24,-
20201019133235,192.168.1.2/24,2
20201019133324,10.20.30.1/16,2
20201019133325,10.20.30.2/16,-
20201019133334,192.168.1.1/24,1
20201019133335,192.168.1.1/24,3
20201019133336,10.20.30.1/16,500
20201019133337,10.20.30.2/16,1
20201019133338,192.168.1.1/24,20
20201019133339,192.168.1.2/24,20
20201019133340,10.20.30.1/16,20
20201019133341,10.20.30.2/16,1
20201019133342,192.168.1.1/24,40
20201019133343,192.168.1.2/24,40
20201019133344,10.20.30.1/16,20
20201019133345,10.20.30.2/16,-
20201019133346,192.168.1.1/24,40
20201019133347,192.168.1.1/24,40
20201019133347,192.168.1.2/24,40
```
- サーバーが重くなった時を表示
```
10.20.30.1/16 HEAVY LOAD at 20201019133336
10.20.30.1/16 HEAVY LOAD at 20201019133340
10.20.30.2/16 HEAVY LOAD at 20201019133341
10.20.30.1/16 HEAVY LOAD at 20201019133344
192.168.1.1/24 HEAVY LOAD at 20201019133346
192.168.1.1/24 HEAVY LOAD at 20201019133347
192.168.1.2/24 HEAVY LOAD at 20201019133347
```
```
UNRECOVERED IP

10.20.30.2/16 not recovered since 20201019133325
```
- IPが回復した時を表示
```
RECOVERED IP SESSION

192.168.1.1/24 recovered at 2020-10-19 13:33:34 from 2020-10-19 13:31:34 time-out: 120 sec
10.20.30.1/16 recovered at 2020-10-19 13:33:40 from 2020-10-19 13:33:36 time-out: 4 sec
10.20.30.1/16 recovered at 2020-10-19 13:33:44 from 2020-10-19 13:33:40 time-out: 4 sec
192.168.1.1/24 recovered at 2020-10-19 13:33:47 from 2020-10-19 13:33:46 time-out: 1 sec
```

### q4.pyの実行後
>  q2.pyを拡張

- 下記のログを使用
```
20201019133124,10.20.30.1/16,2
20201019133125,10.20.30.2/16,2
20201019133134,192.168.1.1/24,-
20201019133135,192.168.1.2/24,2
20201019133224,10.20.30.1/16,2
20201019133225,10.20.30.2/16,-
20201019133234,192.168.1.1/24,-
20201019133235,192.168.1.2/24,2
20201019133324,10.20.30.1/16,2
20201019133325,10.20.30.2/16,-
20201019133334,192.168.1.1/24,-
20201019133335,192.168.1.1/24,-
20201019133336,10.20.30.1/16,-
20201019133337,10.20.30.2/16,-
20201019133338,192.168.1.1/24,20
20201019133339,192.168.1.2/24,20
20201019133340,10.20.30.1/16,20
20201019133341,10.20.30.2/16,20
20201019133342,192.168.1.1/24,40
20201019133343,192.168.1.2/24,40
20201019133344,10.20.30.1/16,1
20201019133345,10.20.30.2/16,-
20201019133346,192.168.1.1/24,40
20201019133347,192.168.1.1/24,40
20201019133347,192.168.1.2/24,40
```
- サーバーダウンした時を表示
```
192.168.1.1/24 SERVER DOWN at 20201019133334
10.20.30.2/16 SERVER DOWN at 20201019133337
```
```
UNRECOVERED IP

10.20.30.2/16 not recovered since 202010191333455
```
- サーバーダウン時／N回タイムアウト時の回復時間を表示
--　サーバダウン時は、サーバーダウンした時からを計算
--　N回タイムアウト時は最初のタイムアウト時から計算
```
RECOVERED IP SESSION

192.168.1.1/24 recovered at 2020-10-19 13:33:38 from 2020-10-19 13:31:34 time-out: 124 sec
10.20.30.2/16 recovered at 2020-10-19 13:33:41 from 2020-10-19 13:33:37 time-out: 4 sec
```